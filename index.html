<index.html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è²¡å‹™è¦åŠƒè—åœ– (Professional Edition)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Noto Sans TC', 'sans-serif'] },
                    colors: {
                        // ç†æƒ³æ¨¡å¼ (ç´«è‰²ç³»)
                        ideal: { 50: '#f5f3ff', 100: '#ede9fe', 500: '#8b5cf6', 600: '#7c3aed', 700: '#6d28d9' },
                        // ç¾å¯¦æ¨¡å¼ (è¤è‰²ç³»)
                        real: { 50: '#fdf8f6', 100: '#f2e8e5', 500: '#9a3412', 600: '#a05a46', 700: '#7c2d12' }
                    }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ç®­é ­ */
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* è‡ªå®šç¾©æ»‘æ¡¿ */
        input[type=range] { -webkit-appearance: none; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: currentColor; margin-top: -8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.1); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #e5e7eb; border-radius: 2px;
        }
        
        /* å‹•ç•«é¡åˆ¥ */
        .theme-transition { transition: all 0.5s ease-in-out; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Modal å‹•ç•«ç‹€æ…‹ */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.2s ease-out; }
        .modal-leave { opacity: 1; transform: scale(1); }
        .modal-leave-active { opacity: 0; transform: scale(0.95); transition: all 0.15s ease-in; }
    </style>
</head>
<body class="bg-ideal-50 text-gray-700 theme-transition" id="main-body">

    <div id="loading-screen" class="fixed inset-0 bg-white z-[99] flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-gray-600 mx-auto mb-2"></div>
            <p class="text-xs text-gray-400">LOADING...</p>
        </div>
    </div>

    <div id="app-container" class="hidden max-w-lg mx-auto min-h-screen relative pb-8 theme-transition shadow-2xl bg-white/30">
        
        <header id="header-bg" class="bg-ideal-600 text-white pt-10 pb-20 px-6 rounded-b-[2.5rem] shadow-lg relative overflow-hidden theme-transition z-0">
            <svg class="absolute top-0 right-0 w-48 h-48 text-white opacity-10 transform translate-x-12 -translate-y-12" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
            <h1 class="text-3xl font-bold text-center tracking-wider drop-shadow-sm">è²¡å‹™è¦åŠƒè—åœ–</h1>
            <p class="text-center text-white/90 text-sm mt-2 font-light tracking-widest">è³‡ç”¢ç´¯ç©èˆ‡æé ˜æ¨¡æ“¬</p>
        </header>

        <div class="px-5 -mt-12 relative z-10">
            <div class="bg-white rounded-3xl shadow-xl p-6 space-y-7 border border-white/60 backdrop-blur-sm">
                
                <div class="grid grid-cols-2 gap-5">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-500 ml-1 block">ç›®å‰å¹´é½¡</label>
                        <input type="text" inputmode="decimal" id="age-current" value="30" class="w-full bg-gray-50 border-2 border-gray-100 rounded-xl px-3 py-3 text-center text-xl font-bold text-gray-800 focus:outline-none focus:border-ideal-500 theme-transition input-field shadow-inner" onblur="handleInputBlur(this)" onfocus="handleInputFocus(this)">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-500 ml-1 block">è·é›¢é€€ä¼‘å¹´é™</label>
                        <input type="text" inputmode="decimal" id="years-to-retire" value="35" class="w-full bg-gray-50 border-2 border-gray-100 rounded-xl px-3 py-3 text-center text-xl font-bold text-gray-800 focus:outline-none focus:border-ideal-500 theme-transition input-field shadow-inner" onblur="handleInputBlur(this)" onfocus="handleInputFocus(this)">
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-500 ml-1 block">åˆå§‹æœ¬é‡‘ (è¬)</label>
                    <input type="text" inputmode="decimal" id="principal" value="100" class="w-full bg-gray-50 border-2 border-gray-100 rounded-xl px-4 py-3 text-right text-xl font-bold text-gray-800 focus:outline-none focus:border-ideal-500 theme-transition input-field shadow-inner" onblur="handleInputBlur(this)" onfocus="handleInputFocus(this)">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-gray-500 ml-1 flex items-center gap-2">
                            æ¯æœˆå®šæœŸæŠ•å…¥ (å…ƒ)
                            <button onclick="openModal('monthly')" class="text-ideal-500 hover:text-ideal-700 transition-colors icon-btn p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M12 2C7.58 2 4 5.58 4 10c0 2.03.69 3.9 1.85 5.4.11.14.15.32.15.5v3.1c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-3.1c0-.18.04-.36.15-.5C19.31 13.9 20 12.03 20 10c0-4.42-3.58-8-8-8zm1 16h-2v-1h2v1zm0-2h-2v-1h2v1zm-1-12c3.31 0 6 2.69 6 6 0 1.94-1.05 3.65-2.63 4.63-.35.22-.57.6-.57 1.02V17h-2.8v-1.35c0-.42-.22-.8-.57-1.02C6.05 13.65 5 11.94 5 10c0-3.31 2.69-6 6-6z"/></svg>
                            </button>
                        </label>
                    </div>
                    <input type="text" inputmode="decimal" id="monthly-invest" value="20,000" class="w-full bg-gray-50 border-2 border-gray-100 rounded-xl px-4 py-3 text-right text-xl font-bold text-gray-800 focus:outline-none focus:border-ideal-500 theme-transition input-field shadow-inner" onblur="handleInputBlur(this)" onfocus="handleInputFocus(this)">
                    <input type="range" id="slider-monthly" min="0" max="100000" step="1000" value="20000" class="w-full text-ideal-500 cursor-pointer slider-input" oninput="syncSlider('monthly-invest', this.value)">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-gray-500 ml-1 flex items-center gap-2">
                            é è¨ˆå¹´åŒ–å ±é…¬ç‡ (%)
                            <button onclick="openModal('roi')" class="text-ideal-500 hover:text-ideal-700 transition-colors icon-btn p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M12 2C7.58 2 4 5.58 4 10c0 2.03.69 3.9 1.85 5.4.11.14.15.32.15.5v3.1c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-3.1c0-.18.04-.36.15-.5C19.31 13.9 20 12.03 20 10c0-4.42-3.58-8-8-8zm1 16h-2v-1h2v1zm0-2h-2v-1h2v1zm-1-12c3.31 0 6 2.69 6 6 0 1.94-1.05 3.65-2.63 4.63-.35.22-.57.6-.57 1.02V17h-2.8v-1.35c0-.42-.22-.8-.57-1.02C6.05 13.65 5 11.94 5 10c0-3.31 2.69-6 6-6z"/></svg>
                            </button>
                        </label>
                        <span id="label-roi" class="text-lg font-bold text-ideal-600 theme-text font-mono">6%</span>
                    </div>
                    <input type="range" id="slider-roi" min="1" max="15" step="0.5" value="6" class="w-full text-ideal-500 cursor-pointer slider-input" oninput="updateROI(this.value)">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-xs font-bold text-gray-500 ml-1">é€€ä¼‘å¾Œï¼Œé è¨ˆæ¯æœˆæé ˜ (å…ƒ)</label>
                    </div>
                    <input type="text" inputmode="decimal" id="monthly-withdraw" value="50,000" class="w-full bg-gray-50 border-2 border-gray-100 rounded-xl px-4 py-3 text-right text-xl font-bold text-gray-800 focus:outline-none focus:border-ideal-500 theme-transition input-field shadow-inner" onblur="handleInputBlur(this)" onfocus="handleInputFocus(this)">
                    <input type="range" id="slider-withdraw" min="10000" max="200000" step="5000" value="50000" class="w-full text-ideal-500 cursor-pointer slider-input" oninput="syncSlider('monthly-withdraw', this.value)">
                </div>

                <hr class="border-gray-100 my-2">

                <div id="result-bar" class="bg-ideal-600 rounded-2xl p-6 text-center text-white theme-transition shadow-lg transform transition-transform hover:scale-[1.01]">
                    <p class="text-xs opacity-90 mb-2 font-medium tracking-widest uppercase">åœ¨é€€ä¼‘æ—¥å·²ç´¯ç©è³‡ç”¢</p>
                    <p id="result-asset" class="text-4xl font-bold tracking-tight">$0</p>
                </div>

                <div>
                    <label class="text-sm font-bold text-gray-600 mb-3 block">å…¶ä»–å½±éŸ¿å› ç´ </label>
                    <div class="flex items-center gap-3 bg-gray-50 p-4 rounded-xl border border-gray-100 hover:border-gray-200 transition-colors">
                        <input type="checkbox" id="check-inflation" class="w-5 h-5 text-real-600 rounded focus:ring-real-500 border-gray-300 transition-colors cursor-pointer" onchange="toggleInflationMode()">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="text-gray-800 font-bold text-sm">è€ƒæ…®é€šè²¨è†¨è„¹</span>
                                <button onclick="openModal('inflation')" class="text-gray-400 hover:text-gray-600">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                                </button>
                            </div>
                            <div id="inflation-input-group" class="hidden mt-2 flex items-center gap-2 fade-in">
                                <span class="text-xs text-gray-500">é ä¼°å¹´é€šè†¨ç‡</span>
                                <input type="number" id="inflation-rate" value="2.5" step="0.1" class="w-20 bg-white border border-gray-300 rounded-lg px-2 py-1 text-right text-sm font-bold focus:outline-none focus:border-real-500 shadow-sm" oninput="calc()">
                                <span class="text-xs text-gray-500">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="conclusion-box" class="p-5 rounded-xl text-sm font-bold text-center theme-transition bg-green-50 text-green-700 border border-green-100 leading-loose">
                    è¨ˆç®—ä¸­...
                </div>

                <div class="h-72 w-full relative mt-4">
                    <canvas id="financeChart"></canvas>
                </div>

            </div>
            
            <footer class="mt-8 mb-4 px-4 text-center">
                <p class="text-[10px] text-gray-400 leading-relaxed font-light">
                    æœ¬è©¦ç®—çµæœåƒ…ä¾›è²¡å‹™è¦åŠƒæ¨¡æ“¬åƒè€ƒï¼Œä¸ä»£è¡¨å°æœªä¾†æŠ•è³‡å ±é…¬ä¹‹ä¿è­‰ã€‚<br>
                    å¯¦éš›è³‡ç”¢ç´¯ç©æƒ…å½¢å°‡å—å¸‚å ´æ³¢å‹•ã€é€šè†¨ç‡åŠç¨…å‹™æ³•è¦è®Šå‹•å½±éŸ¿ã€‚<br>
                    æŠ•è³‡ä¸€å®šæœ‰é¢¨éšªï¼Œå»ºè­°æ‚¨å®šæœŸæª¢è¦–è²¡å‹™è¨ˆç•«ä¸¦å¯©æ…è©•ä¼°ã€‚<br>
                    Designed by Professional Planner
                </p>
            </footer>
        </div>
    </div>

    <div id="info-modal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-900/40 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto pointer-events-none">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                
                <div id="modal-card" class="pointer-events-auto relative transform rounded-2xl bg-white text-left shadow-2xl w-full max-w-sm p-6 border border-gray-100 modal-enter">
                    
                    <button type="button" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 focus:outline-none p-1 transition-colors" onclick="closeModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>

                    <div class="flex items-center gap-3 mb-5 pr-8">
                        <div id="modal-icon-container" class="text-ideal-600 theme-text">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7"><path d="M12 2C7.58 2 4 5.58 4 10c0 2.03.69 3.9 1.85 5.4.11.14.15.32.15.5v3.1c0 .55.45 1 1 1h10c.55 0 1-.45 1-1v-3.1c0-.18.04-.36.15-.5C19.31 13.9 20 12.03 20 10c0-4.42-3.58-8-8-8zm0 14c-2.33 0-4.32-1.45-5.12-3.5h1.67c.7 1.18 1.96 2 3.45 2s2.75-.82 3.45-2h1.67c-.8 2.05-2.79 3.5-5.12 3.5z"/></svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-800 tracking-tight" id="modal-title">...</h3>
                    </div>

                    <div class="space-y-3">
                        <div class="text-sm text-gray-600 leading-relaxed space-y-4" id="modal-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®š Gist URL (è‹¥éœ€å•Ÿç”¨é™æ§é–‹é—œåŠŸèƒ½è«‹å¡«å…¥)
        const CONFIG_URL = 'YOUR_GIST_RAW_URL_HERE'; 

        window.onload = function() {
            setTimeout(() => {
                if(CONFIG_URL.includes('YOUR_GIST')) initApp();
                else {
                    fetch(CONFIG_URL + '?t=' + new Date().getTime())
                        .then(res => res.json())
                        .then(data => data.active ? initApp() : showBlocked(data.message))
                        .catch(() => initApp());
                }
            }, 800);
        };

        function initApp() {
            document.getElementById('loading-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            updateThemeColor(); 
            calc(); 
        }

        function showBlocked(msg) {
            document.getElementById('loading-screen').innerHTML = `<div class="p-8 text-center"><h1 class="text-2xl font-bold mb-4 text-gray-800">æœå‹™ç¶­è­·ä¸­</h1><p class="text-gray-500">${msg || 'è«‹ç¨å¾Œå†è©¦'}</p></div>`;
        }

        // Tools
        function parseRaw(str) { 
            if(!str) return 0;
            return parseFloat(str.toString().replace(/,/g, '')) || 0; 
        }
        function formatMoney(num) { return Math.round(num).toLocaleString('en-US'); }
        
        function handleInputBlur(el) { el.value = formatMoney(parseRaw(el.value)); calc(); }
        function handleInputFocus(el) { let val = parseRaw(el.value); if(val!==0) el.value = val; el.select(); }
        
        function syncSlider(inputId, val) { document.getElementById(inputId).value = formatMoney(val); calc(); }
        function updateROI(val) { document.getElementById('label-roi').textContent = val + '%'; calc(); }

        // Logic
        let chartInstance = null;
        let isInflationMode = false;

        function toggleInflationMode() {
            isInflationMode = document.getElementById('check-inflation').checked;
            const inputGroup = document.getElementById('inflation-input-group');
            isInflationMode ? inputGroup.classList.remove('hidden') : inputGroup.classList.add('hidden');
            updateThemeColor();
            calc();
        }

        function updateThemeColor() {
            const body = document.getElementById('main-body');
            const header = document.getElementById('header-bg');
            const resultBar = document.getElementById('result-bar');
            
            // Define replacement targets
            const els = {
                slider: document.querySelectorAll('.slider-input'),
                themeText: document.querySelectorAll('.theme-text'),
                iconBtn: document.querySelectorAll('.icon-btn'),
                input: document.querySelectorAll('.input-field')
            };

            if (isInflationMode) {
                body.classList.replace('bg-ideal-50', 'bg-real-50');
                header.classList.replace('bg-ideal-600', 'bg-real-600');
                resultBar.classList.replace('bg-ideal-600', 'bg-real-600');
                
                els.slider.forEach(el => el.classList.replace('text-ideal-500', 'text-real-500'));
                els.themeText.forEach(el => el.classList.replace('text-ideal-600', 'text-real-600'));
                els.iconBtn.forEach(el => {
                    el.classList.replace('text-ideal-500', 'text-real-500');
                    el.classList.replace('hover:text-ideal-700', 'hover:text-real-700');
                });
                els.input.forEach(el => el.classList.replace('focus:border-ideal-500', 'focus:border-real-500'));
            } else {
                body.classList.replace('bg-real-50', 'bg-ideal-50');
                header.classList.replace('bg-real-600', 'bg-ideal-600');
                resultBar.classList.replace('bg-real-600', 'bg-ideal-600');
                
                els.slider.forEach(el => el.classList.replace('text-real-500', 'text-ideal-500'));
                els.themeText.forEach(el => el.classList.replace('text-real-600', 'text-ideal-600'));
                els.iconBtn.forEach(el => {
                    el.classList.replace('text-real-500', 'text-ideal-500');
                    el.classList.replace('hover:text-real-700', 'hover:text-ideal-700');
                });
                els.input.forEach(el => el.classList.replace('focus:border-real-500', 'focus:border-ideal-500'));
            }
        }

        function calc() {
            const ageCurrent = parseRaw(document.getElementById('age-current').value);
            const yearsToRetire = parseRaw(document.getElementById('years-to-retire').value);
            const principal = parseRaw(document.getElementById('principal').value) * 10000;
            const monthlyInvest = parseRaw(document.getElementById('monthly-invest').value);
            const roi = parseFloat(document.getElementById('slider-roi').value) / 100;
            const monthlyWithdrawRaw = parseRaw(document.getElementById('monthly-withdraw').value);
            const inflationRate = isInflationMode ? (parseFloat(document.getElementById('inflation-rate').value) || 0) / 100 : 0;
            
            const ageRetire = ageCurrent + yearsToRetire;
            const maxAge = 95;

            let labels = [], dataNominal = [], dataReal = [];
            let currentAsset = principal;
            let discountFactor = 1;

            // Accumulation
            for (let i = 0; i <= yearsToRetire; i++) {
                labels.push((ageCurrent + i) + 'æ­²');
                dataNominal.push(currentAsset);
                dataReal.push(currentAsset / discountFactor);
                currentAsset = currentAsset * (1 + roi) + (monthlyInvest * 12);
                if(isInflationMode) discountFactor *= (1 + inflationRate);
            }

            const assetAtRetirement = dataNominal[dataNominal.length - 1];
            document.getElementById('result-asset').textContent = '$' + formatMoney(assetAtRetirement);

            // Withdrawal
            let yearsInRetirement = maxAge - ageRetire;
            let yearlyWithdraw = monthlyWithdrawRaw * 12;
            if (isInflationMode) yearlyWithdraw *= Math.pow(1 + inflationRate, yearsToRetire);

            let depletedAge = null;

            for (let i = 1; i <= yearsInRetirement; i++) {
                labels.push((ageRetire + i) + 'æ­²');
                currentAsset = currentAsset * (1 + roi) - yearlyWithdraw;
                if (isInflationMode) {
                    yearlyWithdraw *= (1 + inflationRate);
                    discountFactor *= (1 + inflationRate);
                }
                
                if (currentAsset > 0) {
                    dataNominal.push(currentAsset);
                    dataReal.push(currentAsset / discountFactor);
                } else {
                    dataNominal.push(0);
                    dataReal.push(0);
                    if (!depletedAge) depletedAge = ageRetire + i;
                }
            }

            updateConclusion(depletedAge, currentAsset);
            drawChart(labels, dataNominal, dataReal);
        }

        function updateConclusion(depletedAge, finalAsset) {
            const box = document.getElementById('conclusion-box');
            if (depletedAge) {
                box.className = "p-5 rounded-xl text-sm font-bold text-center theme-transition bg-red-50 text-red-700 border border-red-200 leading-loose";
                box.innerHTML = `âš ï¸ <span class="text-lg">é¢¨éšªè­¦ç¤º</span><br>æ‚¨çš„è³‡ç”¢é è¨ˆå°‡åœ¨ <span class="text-2xl border-b-2 border-red-300">${depletedAge}æ­²</span> ç”¨ç›¡ï¼`;
            } else {
                const bg = isInflationMode ? 'bg-orange-50' : 'bg-green-50';
                const txt = isInflationMode ? 'text-real-700' : 'text-ideal-700';
                const border = isInflationMode ? 'border-orange-200' : 'border-green-200';
                box.className = `p-5 rounded-xl text-sm font-bold text-center theme-transition ${bg} ${txt} ${border} leading-loose`;
                box.innerHTML = `ğŸ‰ <span class="text-lg">æ­å–œï¼</span><br>è‡³ 95 æ­²æ™‚è³‡ç”¢é è¨ˆå‰©é¤˜ï¼š<br><span class="text-3xl tracking-tight">$${formatMoney(finalAsset)}</span>`;
            }
        }

        function drawChart(labels, dataNominal, dataReal) {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();

            const nominalColor = isInflationMode ? '#ea580c' : '#8b5cf6'; 
            const nominalBg = isInflationMode ? 'rgba(234, 88, 12, 0.1)' : 'rgba(139, 92, 246, 0.1)';

            const datasets = [{
                type: 'line', label: 'å¸³é¢è³‡ç”¢ (åç›®)', data: dataNominal,
                borderColor: nominalColor, backgroundColor: nominalBg,
                borderWidth: 3, fill: true, tension: 0.4, pointRadius: 0, order: 2
            }];

            if (isInflationMode) {
                datasets.push({
                    type: 'line', label: 'å¯¦è³ªè³¼è²·åŠ›', data: dataReal,
                    borderColor: '#b91c1c', borderWidth: 2, borderDash: [6, 6],
                    fill: false, tension: 0.4, pointRadius: 0, order: 1
                });
            }

            chartInstance = new Chart(ctx, {
                data: { labels: labels, datasets: datasets },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: isInflationMode, labels: { usePointStyle: true } },
                        tooltip: { callbacks: { label: c => ' ' + c.dataset.label + ': $' + formatMoney(c.raw) } }
                    },
                    scales: {
                        x: { grid: {display: false}, ticks: {maxTicksLimit: 6} },
                        y: { position: 'right', grid: {color:'#f3f4f6'}, ticks: {callback: v=>(v/10000).toFixed(0)+'è¬'} }
                    }
                }
            });
        }

        // Modal Data
        const modalData = {
            'monthly': {
                title: 'æ¯æœˆå®šæœŸæŠ•å…¥',
                content: `<p>é€™æ˜¯æ‚¨æ¯æœˆæ‰£é™¤ç”Ÿæ´»é–‹éŠ·èˆ‡æˆ¿è²¸å¾Œï¼Œèƒ½ç©©å®šæ’¥å‡ºç”¨æ–¼æŠ•è³‡çš„é–’ç½®è³‡é‡‘ã€‚</p><div class="bg-yellow-50 p-3 rounded-lg border border-yellow-100 mt-2"><p class="font-bold text-yellow-800 text-xs mb-1">ğŸ’¡ å°ˆå®¶å»ºè­°ï¼š</p><p class="text-xs text-yellow-700">è«‹ç¢ºèªæ‚¨å·²é ç•™ 3-6 å€‹æœˆçš„ç·Šæ€¥é å‚™é‡‘ã€‚</p></div>`
            },
            'roi': {
                title: 'é è¨ˆå¹´åŒ–å ±é…¬ç‡ (%)',
                content: `<p>æŒ‡æŠ•è³‡çµ„åˆé•·æœŸçš„å¹¾ä½•å¹³å‡å¹´æˆé•·ç‡ã€‚</p><p class="font-bold text-gray-800 mt-3 mb-2">ğŸ“Š æ­·å²æ•¸æ“šåƒè€ƒï¼š</p><ul class="space-y-2"><li class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500"></span><span><strong>ä¿å®ˆå‹ (å‚µåˆ¸)ï¼š</strong>ç´„ 3% ~ 4%</span></li><li class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-blue-500"></span><span><strong>ç©©å¥å‹ (è‚¡å‚µ)ï¼š</strong>ç´„ 5% ~ 6%</span></li><li class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-purple-500"></span><span><strong>ç©æ¥µå‹ (è‚¡ç¥¨)ï¼š</strong>ç´„ 7% ~ 9%</span></li></ul>`
            },
            'inflation': {
                title: 'ç‚ºä»€éº¼è¦è€ƒæ…®é€šè†¨ï¼Ÿ',
                content: `<p>ç‰©åƒ¹ä¸Šæ¼²æœƒå°è‡´è²¨å¹£ã€Œå¯¦è³ªè³¼è²·åŠ›ã€ä¸‹é™ã€‚</p><p class="font-bold text-gray-800 mt-3">å‹¾é¸æ­¤é …å¾Œï¼š</p><ul class="list-disc pl-5 space-y-1 mt-1"><li><strong class="text-red-700">ç´…è‰²è™›ç·šï¼š</strong>æ‰£é™¤é€šè†¨å¾Œçš„ã€ŒçœŸå¯¦åƒ¹å€¼ã€ã€‚</li><li><strong>æé ˜é–€æª»è®Šé«˜ï¼š</strong>é€€ä¼‘æ™‚æ‰€éœ€çš„ç”Ÿæ´»è²»æœƒå¤§å¹…å¢åŠ ã€‚</li></ul>`
            }
        };

        function openModal(key) {
            const data = modalData[key];
            if(data) {
                document.getElementById('modal-title').innerHTML = data.title;
                document.getElementById('modal-content').innerHTML = data.content;
                const modal = document.getElementById('info-modal');
                const card = document.getElementById('modal-card');
                
                // é‡ç½®å‹•ç•«ç‹€æ…‹
                card.classList.remove('modal-enter-active');
                card.classList.add('modal-enter');
                modal.classList.remove('hidden');
                
                // è§¸ç™¼ Reflow å¾ŒåŸ·è¡Œå‹•ç•«
                setTimeout(() => {
                    card.classList.remove('modal-enter');
                    card.classList.add('modal-enter-active');
                }, 10);
            }
        }
        
        function closeModal() {
            const modal = document.getElementById('info-modal');
            const card = document.getElementById('modal-card');
            
            card.classList.remove('modal-enter-active');
            card.classList.add('modal-leave-active');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                card.classList.remove('modal-leave-active');
            }, 150);
        }
    </script>
</body>
</html>